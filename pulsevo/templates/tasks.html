{% extends "base.html" %}
{% block content %}

<h2>ðŸ§© Task Management</h2>

<div class="tasks-grid">

  <!-- Left Panel: Task Table -->
  <div class="tasks-table">
    <div class="table-header">
      <input type="text" id="searchInput" placeholder="Search Name..." onkeyup="filterNames()" />
    </div>

    <table id="taskTable">
      <thead>
        <tr>
          <th>Name</th>
          <th>Assigned</th>
          <th>Completed</th>
          <th>Ongoing</th>
          <th>Trend</th>
        </tr>
      </thead>
      <tbody>
        {% for name, data in tasks_summary.items %}
        <tr>
          <td>{{ name }}</td>
          <td>{{ data.assigned }}</td>
          <td>{{ data.completed }}</td>
          <td>{{ data.ongoing }}</td>
          <td>
            {% if data.completed > 0 %}
              <span style="color:#55efc4;">â–²</span>
            {% else %}
              <span style="color:#ff7675;">â–¼</span>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Right Panel: Charts -->
  <div class="chart-side">
    <div class="chart-card">
      <h4>ðŸ“Š Tasks by Project</h4>
      <canvas id="tasksByProject"></canvas>
    </div>
    <div class="chart-card">
      <h4>ðŸš§ Open Issues by Project</h4>
      <canvas id="openIssuesChart"></canvas>
    </div>
  </div>
</div>

<!-- Chart JS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const projectData = {{ projects|safe }};

const labels = projectData.map(p => p.project);
const totals = projectData.map(p => p.total);
const openIssues = projectData.map(p => p.open_issues);

new Chart(document.getElementById("tasksByProject"), {
  type: "doughnut",
  data: {
    labels: labels,
    datasets: [{
      label: "Tasks",
      data: totals,
      backgroundColor: ["#7b68ee","#ff7675","#55efc4"],
    }]
  }
});

new Chart(document.getElementById("openIssuesChart"), {
  type: "doughnut",
  data: {
    labels: labels,
    datasets: [{
      label: "Open Issues",
      data: openIssues,
      backgroundColor: ["#a29bfe","#fab1a0","#81ecec"],
    }]
  }
});

// Simple search filter
function filterNames(){
  const input = document.getElementById("searchInput").value.toLowerCase();
  const rows = document.querySelectorAll("#taskTable tbody tr");
  rows.forEach(row => {
    const name = row.children[0].textContent.toLowerCase();
    row.style.display = name.includes(input) ? "" : "none";
  });
}
</script>

<!-- CSS -->
<style>
.tasks-grid {
  display: grid;
  grid-template-columns: 2fr 1fr;
  gap: 20px;
  margin-top: 20px;
}
.tasks-table {
  background: #141820;
  border: 1px solid #1f2633;
  border-radius: 12px;
  padding: 20px;
}
.tasks-table table {
  width: 100%;
  border-collapse: collapse;
  color: #fff;
}
.tasks-table th, .tasks-table td {
  padding: 10px;
  text-align: left;
  border-bottom: 1px solid #1f2633;
}
.tasks-table tr:hover { background: #1b202b; }
.table-header {
  margin-bottom: 10px;
}
.table-header input {
  width: 100%;
  padding: 8px;
  border: none;
  border-radius: 8px;
  background: #1e2430;
  color: #fff;
}
.chart-side {
  display: flex;
  flex-direction: column;
  gap: 20px;
}
.chart-card {
  background: #141820;
  border: 1px solid #1f2633;
  border-radius: 12px;
  padding: 15px;
  color: #fff;
}
</style>

{% endblock %}
